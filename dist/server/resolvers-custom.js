"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.attachCustomResolvers = attachCustomResolvers;

var _kafkajs = require("kafkajs");

var _opentracing = require("opentracing");

var _arango = _interopRequireDefault(require("./arango"));

var _arangoCollection = require("./arango-collection");

var _auth = require("./auth");

var _config = require("./config");

var _nodeFetch = _interopRequireDefault(require("node-fetch"));

var _tracer = require("./tracer");

var _utils = require("./utils");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const {
  version
} = (0, _utils.packageJson)();

function isObject(test) {
  return typeof test === 'object' && test !== null;
}

function overrideObject(original, overrides) {
  Object.entries(overrides).forEach(([name, overrideValue]) => {
    if (name in original && isObject(overrideValue) && isObject(original[name])) {
      overrideObject(original[name], overrideValue);
    } else {
      original[name] = overrideValue;
    }
  });
}

//------------------------------------------------------------- Query
function info() {
  return {
    version,
    time: Date.now()
  };
}

async function getAccountsCount(_parent, args, context) {
  const tracer = context.db.tracer;
  return _tracer.QTracer.trace(tracer, 'getAccountsCount', async () => {
    await (0, _arangoCollection.requireGrantedAccess)(context, args);
    const result = await context.db.query(`RETURN LENGTH(accounts)`, {});
    const counts = result;
    return counts.length > 0 ? counts[0] : 0;
  }, _tracer.QTracer.getParentSpan(tracer, context));
}

async function getTransactionsCount(_parent, args, context) {
  const tracer = context.db.tracer;
  return _tracer.QTracer.trace(tracer, 'getTransactionsCount', async () => {
    await (0, _arangoCollection.requireGrantedAccess)(context, args);
    const result = await context.db.query(`RETURN LENGTH(transactions)`, {});
    const counts = result;
    return counts.length > 0 ? counts[0] : 0;
  }, _tracer.QTracer.getParentSpan(tracer, context));
}

async function getAccountsTotalBalance(_parent, args, context) {
  const tracer = context.db.tracer;
  return _tracer.QTracer.trace(tracer, 'getAccountsTotalBalance', async () => {
    await (0, _arangoCollection.requireGrantedAccess)(context, args);
    /*
    Because arango can not sum BigInt's we need to sum separately:
    hs = SUM of high bits (from 24-bit and higher)
    ls = SUM of lower 24 bits
    And the total result is (hs << 24) + ls
     */

    const result = await context.db.query(`
            LET d = 16777216
            FOR a in accounts
            LET b = TO_NUMBER(CONCAT("0x", SUBSTRING(a.balance, 2)))
            COLLECT AGGREGATE
                hs = SUM(FLOOR(b / d)),
                ls = SUM(b % (d - 1))
            RETURN { hs, ls }
        `, {});
    const parts = result[0]; //$FlowFixMe

    return (BigInt(parts.hs) * BigInt(0x1000000) + BigInt(parts.ls)).toString();
  }, _tracer.QTracer.getParentSpan(tracer, context));
}

async function getManagementAccessKey(_parent, args, context) {
  return context.auth.getManagementAccessKey();
} //------------------------------------------------------------- Mutation


async function postRequestsUsingRest(requests, context, _span) {
  const config = context.config.requests;
  const url = `${(0, _config.ensureProtocol)(config.server, 'http')}/topics/${config.topic}`;
  const response = await (0, _nodeFetch.default)(url, {
    method: 'POST',
    mode: 'cors',
    cache: 'no-cache',
    credentials: 'same-origin',
    headers: {
      'Content-Type': 'application/json'
    },
    redirect: 'follow',
    referrer: 'no-referrer',
    body: JSON.stringify({
      records: requests.map(request => ({
        key: request.id,
        value: request.body
      }))
    })
  });

  if (response.status !== 200) {
    const message = `Post requests failed: ${await response.text()}`;
    throw new Error(message);
  }
}

async function postRequestsUsingKafka(requests, context, span) {
  const ensureShared = async (name, createValue) => {
    if (context.shared.has(name)) {
      return context.shared.get(name);
    }

    const value = await createValue();
    context.shared.set(name, value);
    return value;
  };

  const config = context.config.requests;
  const producer = await ensureShared('producer', async () => {
    const kafka = await ensureShared('kafka', async () => new _kafkajs.Kafka({
      clientId: 'q-server',
      brokers: [config.server]
    }));
    const newProducer = kafka.producer();
    await newProducer.connect();
    return newProducer;
  });
  const messages = requests.map(request => {
    const traceInfo = {};
    context.db.tracer.inject(span, _opentracing.FORMAT_TEXT_MAP, traceInfo);
    const keyBuffer = Buffer.from(request.id, 'base64');
    const traceBuffer = Object.keys(traceInfo).length > 0 ? Buffer.from(JSON.stringify(traceInfo), 'utf8') : Buffer.from([]);
    const key = Buffer.concat([keyBuffer, traceBuffer]);
    return {
      key,
      value: Buffer.from(request.body, 'base64')
    };
  });
  await producer.send({
    topic: config.topic,
    messages
  });
}

async function checkPostRestrictions(contracts, requests, accessRights) {
  if (accessRights.restrictToAccounts.length === 0) {
    return;
  }

  const accounts = new Set(accessRights.restrictToAccounts);

  for (const request of requests) {
    const message = await contracts.parseMessage({
      bocBase64: request.body
    });

    if (!accounts.has(message.dst)) {
      throw _auth.Auth.unauthorizedError();
    }
  }
}

async function postRequests(_, args, context) {
  const requests = args.requests;

  if (!requests) {
    return [];
  }

  const tracer = context.db.tracer;
  return _tracer.QTracer.trace(tracer, "postRequests", async span => {
    span.setTag('params', requests);
    const accessRights = await (0, _arangoCollection.requireGrantedAccess)(context, args);
    await checkPostRestrictions(context.client.contracts, requests, accessRights);
    const expired = requests.find(x => x.expireAt && Date.now() > x.expireAt);

    if (expired) {
      throw _utils.QError.messageExpired(expired.id, expired.expireAt);
    }

    const messageTraceSpans = requests.map(request => {
      const messageId = Buffer.from(request.id, 'base64').toString('hex');
      const postSpan = tracer.startSpan('postRequest', {
        childOf: _tracer.QTracer.messageRootSpanContext(messageId)
      });
      postSpan.addTags({
        messageId,
        messageSize: Math.ceil(request.body.length * 3 / 4)
      });
      return postSpan;
    });

    try {
      if (context.config.requests.mode === 'rest') {
        await postRequestsUsingRest(requests, context, span);
      } else {
        await postRequestsUsingKafka(requests, context, span);
      }

      context.db.statPostCount.increment();
      context.db.log.debug('postRequests', 'POSTED', args, context.remoteAddress);
    } catch (error) {
      context.db.statPostFailed.increment();
      context.db.log.debug('postRequests', 'FAILED', args, context.remoteAddress);
      throw error;
    } finally {
      messageTraceSpans.forEach(x => x.finish());
    }

    return requests.map(x => x.id);
  }, context.parentSpan);
} //------------------------------------------------------------- Access Management


async function registerAccessKeys(_, args, context) {
  return context.auth.registerAccessKeys(args.account || '', args.keys || [], args.signedManagementAccessKey || '');
}

async function revokeAccessKeys(_, args, context) {
  return context.auth.revokeAccessKeys(args.account || '', args.keys || [], args.signedManagementAccessKey || '');
}

async function finishOperations(_, args, context) {
  const operationIds = new Set(args.operationIds || []);

  if (operationIds.size === 0) {
    return 0;
  }

  return context.db.finishOperations(operationIds);
}

function attachCustomResolvers(db, original) {
  overrideObject(original, {
    Query: {
      info,
      getAccountsCount,
      getTransactionsCount,
      getAccountsTotalBalance,
      getManagementAccessKey,
      aggregateBlockSignatures: db.blocks_signatures.aggregationResolver(),
      aggregateBlocks: db.blocks.aggregationResolver(),
      aggregateTransactions: db.transactions.aggregationResolver(),
      aggregateMessages: db.messages.aggregationResolver(),
      aggregateAccounts: db.accounts.aggregationResolver()
    },
    Mutation: {
      postRequests,
      registerAccessKeys,
      revokeAccessKeys,
      finishOperations
    }
  });
  return original;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NlcnZlci9yZXNvbHZlcnMtY3VzdG9tLmpzIl0sIm5hbWVzIjpbInZlcnNpb24iLCJpc09iamVjdCIsInRlc3QiLCJvdmVycmlkZU9iamVjdCIsIm9yaWdpbmFsIiwib3ZlcnJpZGVzIiwiT2JqZWN0IiwiZW50cmllcyIsImZvckVhY2giLCJuYW1lIiwib3ZlcnJpZGVWYWx1ZSIsImluZm8iLCJ0aW1lIiwiRGF0ZSIsIm5vdyIsImdldEFjY291bnRzQ291bnQiLCJfcGFyZW50IiwiYXJncyIsImNvbnRleHQiLCJ0cmFjZXIiLCJkYiIsIlFUcmFjZXIiLCJ0cmFjZSIsInJlc3VsdCIsInF1ZXJ5IiwiY291bnRzIiwibGVuZ3RoIiwiZ2V0UGFyZW50U3BhbiIsImdldFRyYW5zYWN0aW9uc0NvdW50IiwiZ2V0QWNjb3VudHNUb3RhbEJhbGFuY2UiLCJwYXJ0cyIsIkJpZ0ludCIsImhzIiwibHMiLCJ0b1N0cmluZyIsImdldE1hbmFnZW1lbnRBY2Nlc3NLZXkiLCJhdXRoIiwicG9zdFJlcXVlc3RzVXNpbmdSZXN0IiwicmVxdWVzdHMiLCJfc3BhbiIsImNvbmZpZyIsInVybCIsInNlcnZlciIsInRvcGljIiwicmVzcG9uc2UiLCJtZXRob2QiLCJtb2RlIiwiY2FjaGUiLCJjcmVkZW50aWFscyIsImhlYWRlcnMiLCJyZWRpcmVjdCIsInJlZmVycmVyIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJyZWNvcmRzIiwibWFwIiwicmVxdWVzdCIsImtleSIsImlkIiwidmFsdWUiLCJzdGF0dXMiLCJtZXNzYWdlIiwidGV4dCIsIkVycm9yIiwicG9zdFJlcXVlc3RzVXNpbmdLYWZrYSIsInNwYW4iLCJlbnN1cmVTaGFyZWQiLCJjcmVhdGVWYWx1ZSIsInNoYXJlZCIsImhhcyIsImdldCIsInNldCIsInByb2R1Y2VyIiwia2Fma2EiLCJLYWZrYSIsImNsaWVudElkIiwiYnJva2VycyIsIm5ld1Byb2R1Y2VyIiwiY29ubmVjdCIsIm1lc3NhZ2VzIiwidHJhY2VJbmZvIiwiaW5qZWN0IiwiRk9STUFUX1RFWFRfTUFQIiwia2V5QnVmZmVyIiwiQnVmZmVyIiwiZnJvbSIsInRyYWNlQnVmZmVyIiwia2V5cyIsImNvbmNhdCIsInNlbmQiLCJjaGVja1Bvc3RSZXN0cmljdGlvbnMiLCJjb250cmFjdHMiLCJhY2Nlc3NSaWdodHMiLCJyZXN0cmljdFRvQWNjb3VudHMiLCJhY2NvdW50cyIsIlNldCIsInBhcnNlTWVzc2FnZSIsImJvY0Jhc2U2NCIsImRzdCIsIkF1dGgiLCJ1bmF1dGhvcml6ZWRFcnJvciIsInBvc3RSZXF1ZXN0cyIsIl8iLCJzZXRUYWciLCJjbGllbnQiLCJleHBpcmVkIiwiZmluZCIsIngiLCJleHBpcmVBdCIsIlFFcnJvciIsIm1lc3NhZ2VFeHBpcmVkIiwibWVzc2FnZVRyYWNlU3BhbnMiLCJtZXNzYWdlSWQiLCJwb3N0U3BhbiIsInN0YXJ0U3BhbiIsImNoaWxkT2YiLCJtZXNzYWdlUm9vdFNwYW5Db250ZXh0IiwiYWRkVGFncyIsIm1lc3NhZ2VTaXplIiwiTWF0aCIsImNlaWwiLCJzdGF0UG9zdENvdW50IiwiaW5jcmVtZW50IiwibG9nIiwiZGVidWciLCJyZW1vdGVBZGRyZXNzIiwiZXJyb3IiLCJzdGF0UG9zdEZhaWxlZCIsImZpbmlzaCIsInBhcmVudFNwYW4iLCJyZWdpc3RlckFjY2Vzc0tleXMiLCJhY2NvdW50Iiwic2lnbmVkTWFuYWdlbWVudEFjY2Vzc0tleSIsInJldm9rZUFjY2Vzc0tleXMiLCJmaW5pc2hPcGVyYXRpb25zIiwib3BlcmF0aW9uSWRzIiwic2l6ZSIsImF0dGFjaEN1c3RvbVJlc29sdmVycyIsIlF1ZXJ5IiwiYWdncmVnYXRlQmxvY2tTaWduYXR1cmVzIiwiYmxvY2tzX3NpZ25hdHVyZXMiLCJhZ2dyZWdhdGlvblJlc29sdmVyIiwiYWdncmVnYXRlQmxvY2tzIiwiYmxvY2tzIiwiYWdncmVnYXRlVHJhbnNhY3Rpb25zIiwidHJhbnNhY3Rpb25zIiwiYWdncmVnYXRlTWVzc2FnZXMiLCJhZ2dyZWdhdGVBY2NvdW50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QUEsSUFERztBQUVISSxNQUFBQSxnQkFGRztBQUdIYSxNQUFBQSxvQkFIRztBQUlIQyxNQUFBQSx1QkFKRztBQUtITSxNQUFBQSxzQkFMRztBQU1IeUcsTUFBQUEsd0JBQXdCLEVBQUV4SCxFQUFFLENBQUN5SCxpQkFBSCxDQUFxQkMsbUJBQXJCLEVBTnZCO0FBT0hDLE1BQUFBLGVBQWUsRUFBRTNILEVBQUUsQ0FBQzRILE1BQUgsQ0FBVUYsbUJBQVYsRUFQZDtBQVFIRyxNQUFBQSxxQkFBcUIsRUFBRTdILEVBQUUsQ0FBQzhILFlBQUgsQ0FBZ0JKLG1CQUFoQixFQVJwQjtBQVNISyxNQUFBQSxpQkFBaUIsRUFBRS9ILEVBQUUsQ0FBQzRELFFBQUgsQ0FBWThELG1CQUFaLEVBVGhCO0FBVUhNLE1BQUFBLGlCQUFpQixFQUFFaEksRUFBRSxDQUFDMkUsUUFBSCxDQUFZK0MsbUJBQVo7QUFWaEIsS0FEYztBQWFyQk8sSUFBQUEsUUFBUSxFQUFFO0FBQ04vQyxNQUFBQSxZQURNO0FBRU42QixNQUFBQSxrQkFGTTtBQUdORyxNQUFBQSxnQkFITTtBQUlOQyxNQUFBQTtBQUpNO0FBYlcsR0FBWCxDQUFkO0FBb0JBLFNBQU9uSSxRQUFQO0FBQ0giLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAZmxvd1xyXG5cclxuaW1wb3J0IHsgS2Fma2EsIFByb2R1Y2VyIH0gZnJvbSBcImthZmthanNcIjtcclxuaW1wb3J0IHsgU3BhbiwgRk9STUFUX1RFWFRfTUFQIH0gZnJvbSAnb3BlbnRyYWNpbmcnO1xyXG5pbXBvcnQgdHlwZSB7IFRPTkNvbnRyYWN0cyB9IGZyb20gXCJ0b24tY2xpZW50LWpzL3R5cGVzXCI7XHJcbmltcG9ydCBBcmFuZ28gZnJvbSBcIi4vYXJhbmdvXCI7XHJcbmltcG9ydCB7IHJlcXVpcmVHcmFudGVkQWNjZXNzIH0gZnJvbSBcIi4vYXJhbmdvLWNvbGxlY3Rpb25cIjtcclxuaW1wb3J0IHR5cGUge1xyXG4gICAgR3JhcGhRTFJlcXVlc3RDb250ZXh0XHJcbn0gZnJvbSBcIi4vYXJhbmdvLWNvbGxlY3Rpb25cIjtcclxuaW1wb3J0IHsgQXV0aCB9IGZyb20gXCIuL2F1dGhcIjtcclxuaW1wb3J0IHsgZW5zdXJlUHJvdG9jb2wgfSBmcm9tIFwiLi9jb25maWdcIjtcclxuaW1wb3J0IGZldGNoIGZyb20gJ25vZGUtZmV0Y2gnO1xyXG5pbXBvcnQgdHlwZSB7IEFjY2Vzc0tleSwgQWNjZXNzUmlnaHRzIH0gZnJvbSBcIi4vYXV0aFwiO1xyXG5pbXBvcnQgeyBRVHJhY2VyIH0gZnJvbSBcIi4vdHJhY2VyXCI7XHJcbmltcG9ydCB7cGFja2FnZUpzb24sIFFFcnJvcn0gZnJvbSBcIi4vdXRpbHNcIjtcclxuY29uc3Qge3ZlcnNpb259ID0gcGFja2FnZUpzb24oKTtcclxuXHJcbmZ1bmN0aW9uIGlzT2JqZWN0KHRlc3Q6IGFueSk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHR5cGVvZiB0ZXN0ID09PSAnb2JqZWN0JyAmJiB0ZXN0ICE9PSBudWxsO1xyXG59XHJcblxyXG5mdW5jdGlvbiBvdmVycmlkZU9iamVjdChvcmlnaW5hbDogYW55LCBvdmVycmlkZXM6IGFueSkge1xyXG4gICAgT2JqZWN0LmVudHJpZXMob3ZlcnJpZGVzKS5mb3JFYWNoKChbbmFtZSwgb3ZlcnJpZGVWYWx1ZV0pID0+IHtcclxuICAgICAgICBpZiAoKG5hbWUgaW4gb3JpZ2luYWwpICYmIGlzT2JqZWN0KG92ZXJyaWRlVmFsdWUpICYmIGlzT2JqZWN0KG9yaWdpbmFsW25hbWVdKSkge1xyXG4gICAgICAgICAgICBvdmVycmlkZU9iamVjdChvcmlnaW5hbFtuYW1lXSwgb3ZlcnJpZGVWYWx1ZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgb3JpZ2luYWxbbmFtZV0gPSBvdmVycmlkZVZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59XHJcblxyXG50eXBlIEluZm8gPSB7XHJcbiAgICB2ZXJzaW9uOiBzdHJpbmcsXHJcbn1cclxuXHJcbnR5cGUgUmVxdWVzdCA9IHtcclxuICAgIGlkOiBzdHJpbmcsXHJcbiAgICBib2R5OiBzdHJpbmcsXHJcbiAgICBleHBpcmVBdDogbnVtYmVyLFxyXG59XHJcblxyXG5leHBvcnQgdHlwZSBHcmFwaFFMUmVxdWVzdENvbnRleHRFeCA9IEdyYXBoUUxSZXF1ZXN0Q29udGV4dCAmIHtcclxuICAgIGRiOiBBcmFuZ28sXHJcbn1cclxuXHJcbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBRdWVyeVxyXG5cclxuZnVuY3Rpb24gaW5mbygpOiBJbmZvIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgdmVyc2lvbixcclxuICAgICAgICB0aW1lOiBEYXRlLm5vdygpLFxyXG4gICAgfTtcclxufVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gZ2V0QWNjb3VudHNDb3VudChfcGFyZW50LCBhcmdzLCBjb250ZXh0OiBHcmFwaFFMUmVxdWVzdENvbnRleHRFeCk6IFByb21pc2U8bnVtYmVyPiB7XHJcbiAgICBjb25zdCB0cmFjZXIgPSBjb250ZXh0LmRiLnRyYWNlcjtcclxuICAgIHJldHVybiBRVHJhY2VyLnRyYWNlKHRyYWNlciwgJ2dldEFjY291bnRzQ291bnQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgYXdhaXQgcmVxdWlyZUdyYW50ZWRBY2Nlc3MoY29udGV4dCwgYXJncyk7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0OiBhbnkgPSBhd2FpdCBjb250ZXh0LmRiLnF1ZXJ5KGBSRVRVUk4gTEVOR1RIKGFjY291bnRzKWAsIHt9KTtcclxuICAgICAgICBjb25zdCBjb3VudHMgPSAocmVzdWx0OiBudW1iZXJbXSk7XHJcbiAgICAgICAgcmV0dXJuIGNvdW50cy5sZW5ndGggPiAwID8gY291bnRzWzBdIDogMDtcclxuICAgIH0sIFFUcmFjZXIuZ2V0UGFyZW50U3Bhbih0cmFjZXIsIGNvbnRleHQpKVxyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiBnZXRUcmFuc2FjdGlvbnNDb3VudChfcGFyZW50LCBhcmdzLCBjb250ZXh0OiBHcmFwaFFMUmVxdWVzdENvbnRleHRFeCk6IFByb21pc2U8bnVtYmVyPiB7XHJcbiAgICBjb25zdCB0cmFjZXIgPSBjb250ZXh0LmRiLnRyYWNlcjtcclxuICAgIHJldHVybiBRVHJhY2VyLnRyYWNlKHRyYWNlciwgJ2dldFRyYW5zYWN0aW9uc0NvdW50JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgIGF3YWl0IHJlcXVpcmVHcmFudGVkQWNjZXNzKGNvbnRleHQsIGFyZ3MpO1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdDogYW55ID0gYXdhaXQgY29udGV4dC5kYi5xdWVyeShgUkVUVVJOIExFTkdUSCh0cmFuc2FjdGlvbnMpYCwge30pO1xyXG4gICAgICAgIGNvbnN0IGNvdW50cyA9IChyZXN1bHQ6IG51bWJlcltdKTtcclxuICAgICAgICByZXR1cm4gY291bnRzLmxlbmd0aCA+IDAgPyBjb3VudHNbMF0gOiAwO1xyXG4gICAgfSwgUVRyYWNlci5nZXRQYXJlbnRTcGFuKHRyYWNlciwgY29udGV4dCkpXHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGdldEFjY291bnRzVG90YWxCYWxhbmNlKF9wYXJlbnQsIGFyZ3MsIGNvbnRleHQ6IEdyYXBoUUxSZXF1ZXN0Q29udGV4dEV4KTogUHJvbWlzZTxTdHJpbmc+IHtcclxuICAgIGNvbnN0IHRyYWNlciA9IGNvbnRleHQuZGIudHJhY2VyO1xyXG4gICAgcmV0dXJuIFFUcmFjZXIudHJhY2UodHJhY2VyLCAnZ2V0QWNjb3VudHNUb3RhbEJhbGFuY2UnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgYXdhaXQgcmVxdWlyZUdyYW50ZWRBY2Nlc3MoY29udGV4dCwgYXJncyk7XHJcbiAgICAgICAgLypcclxuICAgICAgICBCZWNhdXNlIGFyYW5nbyBjYW4gbm90IHN1bSBCaWdJbnQncyB3ZSBuZWVkIHRvIHN1bSBzZXBhcmF0ZWx5OlxyXG4gICAgICAgIGhzID0gU1VNIG9mIGhpZ2ggYml0cyAoZnJvbSAyNC1iaXQgYW5kIGhpZ2hlcilcclxuICAgICAgICBscyA9IFNVTSBvZiBsb3dlciAyNCBiaXRzXHJcbiAgICAgICAgQW5kIHRoZSB0b3RhbCByZXN1bHQgaXMgKGhzIDw8IDI0KSArIGxzXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgY29uc3QgcmVzdWx0OiBhbnkgPSBhd2FpdCBjb250ZXh0LmRiLnF1ZXJ5KGBcclxuICAgICAgICAgICAgTEVUIGQgPSAxNjc3NzIxNlxyXG4gICAgICAgICAgICBGT1IgYSBpbiBhY2NvdW50c1xyXG4gICAgICAgICAgICBMRVQgYiA9IFRPX05VTUJFUihDT05DQVQoXCIweFwiLCBTVUJTVFJJTkcoYS5iYWxhbmNlLCAyKSkpXHJcbiAgICAgICAgICAgIENPTExFQ1QgQUdHUkVHQVRFXHJcbiAgICAgICAgICAgICAgICBocyA9IFNVTShGTE9PUihiIC8gZCkpLFxyXG4gICAgICAgICAgICAgICAgbHMgPSBTVU0oYiAlIChkIC0gMSkpXHJcbiAgICAgICAgICAgIFJFVFVSTiB7IGhzLCBscyB9XHJcbiAgICAgICAgYCwge30pO1xyXG4gICAgICAgIGNvbnN0IHBhcnRzID0gKHJlc3VsdDogeyBoczogbnVtYmVyLCBsczogbnVtYmVyIH1bXSlbMF07XHJcbiAgICAgICAgLy8kRmxvd0ZpeE1lXHJcbiAgICAgICAgcmV0dXJuIChCaWdJbnQocGFydHMuaHMpICogQmlnSW50KDB4MTAwMDAwMCkgKyBCaWdJbnQocGFydHMubHMpKS50b1N0cmluZygpO1xyXG4gICAgfSwgUVRyYWNlci5nZXRQYXJlbnRTcGFuKHRyYWNlciwgY29udGV4dCkpXHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGdldE1hbmFnZW1lbnRBY2Nlc3NLZXkoX3BhcmVudCwgYXJncywgY29udGV4dDogR3JhcGhRTFJlcXVlc3RDb250ZXh0RXgpOiBQcm9taXNlPHN0cmluZz4ge1xyXG4gICAgcmV0dXJuIGNvbnRleHQuYXV0aC5nZXRNYW5hZ2VtZW50QWNjZXNzS2V5KCk7XHJcbn1cclxuXHJcblxyXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gTXV0YXRpb25cclxuXHJcblxyXG5hc3luYyBmdW5jdGlvbiBwb3N0UmVxdWVzdHNVc2luZ1Jlc3QocmVxdWVzdHM6IFJlcXVlc3RbXSwgY29udGV4dDogR3JhcGhRTFJlcXVlc3RDb250ZXh0RXgsIF9zcGFuOiBTcGFuKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICBjb25zdCBjb25maWcgPSBjb250ZXh0LmNvbmZpZy5yZXF1ZXN0cztcclxuICAgIGNvbnN0IHVybCA9IGAke2Vuc3VyZVByb3RvY29sKGNvbmZpZy5zZXJ2ZXIsICdodHRwJyl9L3RvcGljcy8ke2NvbmZpZy50b3BpY31gO1xyXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsIHtcclxuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICBtb2RlOiAnY29ycycsXHJcbiAgICAgICAgY2FjaGU6ICduby1jYWNoZScsXHJcbiAgICAgICAgY3JlZGVudGlhbHM6ICdzYW1lLW9yaWdpbicsXHJcbiAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcmVkaXJlY3Q6ICdmb2xsb3cnLFxyXG4gICAgICAgIHJlZmVycmVyOiAnbm8tcmVmZXJyZXInLFxyXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICAgICAgcmVjb3JkczogcmVxdWVzdHMubWFwKChyZXF1ZXN0KSA9PiAoe1xyXG4gICAgICAgICAgICAgICAga2V5OiByZXF1ZXN0LmlkLFxyXG4gICAgICAgICAgICAgICAgdmFsdWU6IHJlcXVlc3QuYm9keSxcclxuICAgICAgICAgICAgfSkpLFxyXG4gICAgICAgIH0pLFxyXG4gICAgfSk7XHJcbiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcclxuICAgICAgICBjb25zdCBtZXNzYWdlID0gYFBvc3QgcmVxdWVzdHMgZmFpbGVkOiAke2F3YWl0IHJlc3BvbnNlLnRleHQoKX1gO1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlKTtcclxuICAgIH1cclxufVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gcG9zdFJlcXVlc3RzVXNpbmdLYWZrYShyZXF1ZXN0czogUmVxdWVzdFtdLCBjb250ZXh0OiBHcmFwaFFMUmVxdWVzdENvbnRleHRFeCwgc3BhbjogU3Bhbik6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgY29uc3QgZW5zdXJlU2hhcmVkID0gYXN5bmMgKG5hbWUsIGNyZWF0ZVZhbHVlOiAoKSA9PiBQcm9taXNlPGFueT4pID0+IHtcclxuICAgICAgICBpZiAoY29udGV4dC5zaGFyZWQuaGFzKG5hbWUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjb250ZXh0LnNoYXJlZC5nZXQobmFtZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHZhbHVlID0gYXdhaXQgY3JlYXRlVmFsdWUoKTtcclxuICAgICAgICBjb250ZXh0LnNoYXJlZC5zZXQobmFtZSwgdmFsdWUpO1xyXG4gICAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgY29uZmlnID0gY29udGV4dC5jb25maWcucmVxdWVzdHM7XHJcbiAgICBjb25zdCBwcm9kdWNlcjogUHJvZHVjZXIgPSBhd2FpdCBlbnN1cmVTaGFyZWQoJ3Byb2R1Y2VyJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGthZmthOiBLYWZrYSA9IGF3YWl0IGVuc3VyZVNoYXJlZCgna2Fma2EnLCBhc3luYyAoKSA9PiBuZXcgS2Fma2Eoe1xyXG4gICAgICAgICAgICBjbGllbnRJZDogJ3Etc2VydmVyJyxcclxuICAgICAgICAgICAgYnJva2VyczogW2NvbmZpZy5zZXJ2ZXJdXHJcbiAgICAgICAgfSkpO1xyXG4gICAgICAgIGNvbnN0IG5ld1Byb2R1Y2VyID0ga2Fma2EucHJvZHVjZXIoKTtcclxuICAgICAgICBhd2FpdCBuZXdQcm9kdWNlci5jb25uZWN0KCk7XHJcbiAgICAgICAgcmV0dXJuIG5ld1Byb2R1Y2VyO1xyXG5cclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IG1lc3NhZ2VzID0gcmVxdWVzdHMubWFwKChyZXF1ZXN0KSA9PiB7XHJcbiAgICAgICAgY29uc3QgdHJhY2VJbmZvID0ge307XHJcbiAgICAgICAgY29udGV4dC5kYi50cmFjZXIuaW5qZWN0KHNwYW4sIEZPUk1BVF9URVhUX01BUCwgdHJhY2VJbmZvKTtcclxuICAgICAgICBjb25zdCBrZXlCdWZmZXIgPSBCdWZmZXIuZnJvbShyZXF1ZXN0LmlkLCAnYmFzZTY0Jyk7XHJcbiAgICAgICAgY29uc3QgdHJhY2VCdWZmZXIgPSAoT2JqZWN0LmtleXModHJhY2VJbmZvKS5sZW5ndGggPiAwKVxyXG4gICAgICAgICAgICA/IEJ1ZmZlci5mcm9tKEpTT04uc3RyaW5naWZ5KHRyYWNlSW5mbyksICd1dGY4JylcclxuICAgICAgICAgICAgOiBCdWZmZXIuZnJvbShbXSk7XHJcbiAgICAgICAgY29uc3Qga2V5ID0gQnVmZmVyLmNvbmNhdChba2V5QnVmZmVyLCB0cmFjZUJ1ZmZlcl0pO1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGtleSxcclxuICAgICAgICAgICAgdmFsdWU6IEJ1ZmZlci5mcm9tKHJlcXVlc3QuYm9keSwgJ2Jhc2U2NCcpLFxyXG4gICAgICAgIH07XHJcbiAgICB9KTtcclxuICAgIGF3YWl0IHByb2R1Y2VyLnNlbmQoe1xyXG4gICAgICAgIHRvcGljOiBjb25maWcudG9waWMsXHJcbiAgICAgICAgbWVzc2FnZXMsXHJcbiAgICB9KTtcclxufVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gY2hlY2tQb3N0UmVzdHJpY3Rpb25zKFxyXG4gICAgY29udHJhY3RzOiBUT05Db250cmFjdHMsXHJcbiAgICByZXF1ZXN0czogUmVxdWVzdFtdLFxyXG4gICAgYWNjZXNzUmlnaHRzOiBBY2Nlc3NSaWdodHMsXHJcbikge1xyXG4gICAgaWYgKGFjY2Vzc1JpZ2h0cy5yZXN0cmljdFRvQWNjb3VudHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgYWNjb3VudHMgPSBuZXcgU2V0KGFjY2Vzc1JpZ2h0cy5yZXN0cmljdFRvQWNjb3VudHMpO1xyXG4gICAgZm9yIChjb25zdCByZXF1ZXN0OiBSZXF1ZXN0IG9mIHJlcXVlc3RzKSB7XHJcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IGF3YWl0IGNvbnRyYWN0cy5wYXJzZU1lc3NhZ2Uoe1xyXG4gICAgICAgICAgICBib2NCYXNlNjQ6IHJlcXVlc3QuYm9keSxcclxuICAgICAgICB9KTtcclxuICAgICAgICBpZiAoIWFjY291bnRzLmhhcyhtZXNzYWdlLmRzdCkpIHtcclxuICAgICAgICAgICAgdGhyb3cgQXV0aC51bmF1dGhvcml6ZWRFcnJvcigpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gcG9zdFJlcXVlc3RzKFxyXG4gICAgXyxcclxuICAgIGFyZ3M6IHsgcmVxdWVzdHM6IFJlcXVlc3RbXSwgYWNjZXNzS2V5Pzogc3RyaW5nIH0sXHJcbiAgICBjb250ZXh0OiBHcmFwaFFMUmVxdWVzdENvbnRleHRFeCxcclxuKTogUHJvbWlzZTxzdHJpbmdbXT4ge1xyXG4gICAgY29uc3QgcmVxdWVzdHM6ID8oUmVxdWVzdFtdKSA9IGFyZ3MucmVxdWVzdHM7XHJcbiAgICBpZiAoIXJlcXVlc3RzKSB7XHJcbiAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHRyYWNlciA9IGNvbnRleHQuZGIudHJhY2VyO1xyXG4gICAgcmV0dXJuIFFUcmFjZXIudHJhY2UodHJhY2VyLCBcInBvc3RSZXF1ZXN0c1wiLCBhc3luYyAoc3BhbjogU3BhbikgPT4ge1xyXG4gICAgICAgIHNwYW4uc2V0VGFnKCdwYXJhbXMnLCByZXF1ZXN0cyk7XHJcbiAgICAgICAgY29uc3QgYWNjZXNzUmlnaHRzID0gYXdhaXQgcmVxdWlyZUdyYW50ZWRBY2Nlc3MoY29udGV4dCwgYXJncyk7XHJcbiAgICAgICAgYXdhaXQgY2hlY2tQb3N0UmVzdHJpY3Rpb25zKGNvbnRleHQuY2xpZW50LmNvbnRyYWN0cywgcmVxdWVzdHMsIGFjY2Vzc1JpZ2h0cyk7XHJcblxyXG4gICAgICAgIGNvbnN0IGV4cGlyZWQ6ID9SZXF1ZXN0ID0gcmVxdWVzdHMuZmluZCh4ID0+IHguZXhwaXJlQXQgJiYgKERhdGUubm93KCkgPiB4LmV4cGlyZUF0KSk7XHJcbiAgICAgICAgaWYgKGV4cGlyZWQpIHtcclxuICAgICAgICAgICAgdGhyb3cgUUVycm9yLm1lc3NhZ2VFeHBpcmVkKGV4cGlyZWQuaWQsIGV4cGlyZWQuZXhwaXJlQXQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgbWVzc2FnZVRyYWNlU3BhbnMgPSByZXF1ZXN0cy5tYXAoKHJlcXVlc3QpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbWVzc2FnZUlkID0gQnVmZmVyLmZyb20ocmVxdWVzdC5pZCwgJ2Jhc2U2NCcpLnRvU3RyaW5nKCdoZXgnKTtcclxuICAgICAgICAgICAgY29uc3QgcG9zdFNwYW4gPSB0cmFjZXIuc3RhcnRTcGFuKCdwb3N0UmVxdWVzdCcsIHtcclxuICAgICAgICAgICAgICAgIGNoaWxkT2Y6IFFUcmFjZXIubWVzc2FnZVJvb3RTcGFuQ29udGV4dChtZXNzYWdlSWQpLFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcG9zdFNwYW4uYWRkVGFncyh7XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlSWQsXHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlU2l6ZTogTWF0aC5jZWlsKHJlcXVlc3QuYm9keS5sZW5ndGgqMy80KSxcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgcmV0dXJuIHBvc3RTcGFuO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGlmIChjb250ZXh0LmNvbmZpZy5yZXF1ZXN0cy5tb2RlID09PSAncmVzdCcpIHtcclxuICAgICAgICAgICAgICAgIGF3YWl0IHBvc3RSZXF1ZXN0c1VzaW5nUmVzdChyZXF1ZXN0cywgY29udGV4dCwgc3Bhbik7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCBwb3N0UmVxdWVzdHNVc2luZ0thZmthKHJlcXVlc3RzLCBjb250ZXh0LCBzcGFuKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb250ZXh0LmRiLnN0YXRQb3N0Q291bnQuaW5jcmVtZW50KCk7XHJcbiAgICAgICAgICAgIGNvbnRleHQuZGIubG9nLmRlYnVnKCdwb3N0UmVxdWVzdHMnLCAnUE9TVEVEJywgYXJncywgY29udGV4dC5yZW1vdGVBZGRyZXNzKTtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICBjb250ZXh0LmRiLnN0YXRQb3N0RmFpbGVkLmluY3JlbWVudCgpO1xyXG4gICAgICAgICAgICBjb250ZXh0LmRiLmxvZy5kZWJ1ZygncG9zdFJlcXVlc3RzJywgJ0ZBSUxFRCcsIGFyZ3MsIGNvbnRleHQucmVtb3RlQWRkcmVzcyk7XHJcbiAgICAgICAgICAgIHRocm93IGVycm9yO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmaW5hbGx5IHtcclxuICAgICAgICAgICAgbWVzc2FnZVRyYWNlU3BhbnMuZm9yRWFjaCh4ID0+IHguZmluaXNoKCkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVxdWVzdHMubWFwKHggPT4geC5pZCk7XHJcbiAgICB9LCBjb250ZXh0LnBhcmVudFNwYW4pO1xyXG59XHJcblxyXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gQWNjZXNzIE1hbmFnZW1lbnRcclxuXHJcbnR5cGUgTWFuYWdlbWVudEFyZ3MgPSB7XHJcbiAgICBhY2NvdW50Pzogc3RyaW5nLFxyXG4gICAgc2lnbmVkTWFuYWdlbWVudEFjY2Vzc0tleT86IHN0cmluZyxcclxufVxyXG5cclxudHlwZSBSZWdpc3RlckFjY2Vzc0tleXNBcmdzID0gTWFuYWdlbWVudEFyZ3MgJiB7XHJcbiAgICBrZXlzOiBBY2Nlc3NLZXlbXSxcclxufVxyXG5cclxudHlwZSBSZXZva2VBY2Nlc3NLZXlzQXJncyA9IE1hbmFnZW1lbnRBcmdzICYge1xyXG4gICAga2V5czogc3RyaW5nW10sXHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIHJlZ2lzdGVyQWNjZXNzS2V5cyhcclxuICAgIF8sXHJcbiAgICBhcmdzOiBSZWdpc3RlckFjY2Vzc0tleXNBcmdzLFxyXG4gICAgY29udGV4dDogR3JhcGhRTFJlcXVlc3RDb250ZXh0RXgsXHJcbik6IFByb21pc2U8bnVtYmVyPiB7XHJcbiAgICByZXR1cm4gY29udGV4dC5hdXRoLnJlZ2lzdGVyQWNjZXNzS2V5cyhcclxuICAgICAgICBhcmdzLmFjY291bnQgfHwgJycsXHJcbiAgICAgICAgYXJncy5rZXlzIHx8IFtdLFxyXG4gICAgICAgIGFyZ3Muc2lnbmVkTWFuYWdlbWVudEFjY2Vzc0tleSB8fCAnJyk7XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIHJldm9rZUFjY2Vzc0tleXMoXHJcbiAgICBfLFxyXG4gICAgYXJnczogUmV2b2tlQWNjZXNzS2V5c0FyZ3MsXHJcbiAgICBjb250ZXh0OiBHcmFwaFFMUmVxdWVzdENvbnRleHRFeCxcclxuKTogUHJvbWlzZTxudW1iZXI+IHtcclxuICAgIHJldHVybiBjb250ZXh0LmF1dGgucmV2b2tlQWNjZXNzS2V5cyhcclxuICAgICAgICBhcmdzLmFjY291bnQgfHwgJycsXHJcbiAgICAgICAgYXJncy5rZXlzIHx8IFtdLFxyXG4gICAgICAgIGFyZ3Muc2lnbmVkTWFuYWdlbWVudEFjY2Vzc0tleSB8fCAnJyk7XHJcbn1cclxuXHJcbnR5cGUgRmluaXNoT3BlcmF0aW9uc0FyZ3MgPSB7XHJcbiAgICBvcGVyYXRpb25JZHM/OiBzdHJpbmdbXSxcclxufVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gZmluaXNoT3BlcmF0aW9ucyhcclxuICAgIF8sXHJcbiAgICBhcmdzOiBGaW5pc2hPcGVyYXRpb25zQXJncyxcclxuICAgIGNvbnRleHQ6IEdyYXBoUUxSZXF1ZXN0Q29udGV4dEV4LFxyXG4pOiBQcm9taXNlPG51bWJlcj4ge1xyXG4gICAgY29uc3Qgb3BlcmF0aW9uSWRzID0gbmV3IFNldChhcmdzLm9wZXJhdGlvbklkcyB8fCBbXSk7XHJcbiAgICBpZiAob3BlcmF0aW9uSWRzLnNpemUgPT09IDApIHtcclxuICAgICAgICByZXR1cm4gMDtcclxuICAgIH1cclxuICAgIHJldHVybiBjb250ZXh0LmRiLmZpbmlzaE9wZXJhdGlvbnMob3BlcmF0aW9uSWRzKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGF0dGFjaEN1c3RvbVJlc29sdmVycyhkYjogQXJhbmdvLCBvcmlnaW5hbDogYW55KTogYW55IHtcclxuICAgIG92ZXJyaWRlT2JqZWN0KG9yaWdpbmFsLCB7XHJcbiAgICAgICAgUXVlcnk6IHtcclxuICAgICAgICAgICAgaW5mbyxcclxuICAgICAgICAgICAgZ2V0QWNjb3VudHNDb3VudCxcclxuICAgICAgICAgICAgZ2V0VHJhbnNhY3Rpb25zQ291bnQsXHJcbiAgICAgICAgICAgIGdldEFjY291bnRzVG90YWxCYWxhbmNlLFxyXG4gICAgICAgICAgICBnZXRNYW5hZ2VtZW50QWNjZXNzS2V5LFxyXG4gICAgICAgICAgICBhZ2dyZWdhdGVCbG9ja1NpZ25hdHVyZXM6IGRiLmJsb2Nrc19zaWduYXR1cmVzLmFnZ3JlZ2F0aW9uUmVzb2x2ZXIoKSxcclxuICAgICAgICAgICAgYWdncmVnYXRlQmxvY2tzOiBkYi5ibG9ja3MuYWdncmVnYXRpb25SZXNvbHZlcigpLFxyXG4gICAgICAgICAgICBhZ2dyZWdhdGVUcmFuc2FjdGlvbnM6IGRiLnRyYW5zYWN0aW9ucy5hZ2dyZWdhdGlvblJlc29sdmVyKCksXHJcbiAgICAgICAgICAgIGFnZ3JlZ2F0ZU1lc3NhZ2VzOiBkYi5tZXNzYWdlcy5hZ2dyZWdhdGlvblJlc29sdmVyKCksXHJcbiAgICAgICAgICAgIGFnZ3JlZ2F0ZUFjY291bnRzOiBkYi5hY2NvdW50cy5hZ2dyZWdhdGlvblJlc29sdmVyKCksXHJcbiAgICAgICAgfSxcclxuICAgICAgICBNdXRhdGlvbjoge1xyXG4gICAgICAgICAgICBwb3N0UmVxdWVzdHMsXHJcbiAgICAgICAgICAgIHJlZ2lzdGVyQWNjZXNzS2V5cyxcclxuICAgICAgICAgICAgcmV2b2tlQWNjZXNzS2V5cyxcclxuICAgICAgICAgICAgZmluaXNoT3BlcmF0aW9ucyxcclxuICAgICAgICB9LFxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gb3JpZ2luYWw7XHJcbn1cclxuIl19