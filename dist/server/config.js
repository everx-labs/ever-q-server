"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ensureProtocol = ensureProtocol;
exports.parseArangoConfig = parseArangoConfig;
exports.parseMemCachedConfig = parseMemCachedConfig;
exports.overrideDefs = overrideDefs;
exports.resolveValues = resolveValues;
exports.createConfig = createConfig;
exports.parseDataConfig = parseDataConfig;
exports.STATS = exports.programOptions = exports.requestsMode = void 0;

var _os = _interopRequireDefault(require("os"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/*
/*
 * Copyright 2018-2020 TON DEV SOLUTIONS LTD.
 *
 * Licensed under the SOFTWARE EVALUATION License (the "License"); you may not use
 * this file except in compliance with the License.  You may obtain a copy of the
 * License at:
 *
 * http://www.ton.dev/licenses
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific TON DEV software governing permissions and
 * limitations under the License.
 */
const DEFAULT_LISTENER_RESTART_TIMEOUT = 1000;
const DEFAULT_ARANGO_MAX_SOCKETS = 100;
const DEFAULT_SLOW_QUERIES_ARANGO_MAX_SOCKETS = 3;
const requestsMode = {
  kafka: 'kafka',
  rest: 'rest'
};
exports.requestsMode = requestsMode;
const programOptions = {};
exports.programOptions = programOptions;

const toPascal = s => `${s[0].toUpperCase()}${s.substr(1).toLowerCase()}`;

const opt = (option, def, description) => {
  const words = option.split('-');
  const name = `${words[0]}${words.slice(1).map(toPascal).join('')}`;
  const env = `Q_${words.map(x => x.toUpperCase()).join('_')}`;
  programOptions[name] = {
    option: `--${option} <value>`,
    env,
    def,
    description: `${description}${def && ` (default: "${def}")`}`
  };
};

const dataOpt = prefix => {
  const o = name => `${prefix.toLowerCase().split(' ').join('-')}-${name}`;

  const d = text => `${toPascal(prefix)} ${text}`;

  opt(o('mut'), 'arangodb', d('mutable db config url'));
  opt(o('hot'), 'arangodb', d('hot db config url'));
  opt(o('cold'), '', d('cold db config urls (comma separated)'));
  opt(o('cache'), '', d('cache config url'));
};

opt('host', getIp(), 'Listening address');
opt('port', '4000', 'Listening port');
opt('keep-alive', '60000', 'GraphQL keep alive ms');
opt('requests-mode', 'kafka', 'Requests mode (kafka | rest)');
opt('requests-server', 'kafka:9092', 'Requests server url');
opt('requests-topic', 'requests', 'Requests topic name');
dataOpt('data');
dataOpt('slow queries');
opt('auth-endpoint', '', 'Auth endpoint');
opt('mam-access-keys', '', 'Access keys used to authorize mam endpoint access');
opt('jaeger-endpoint', '', 'Jaeger endpoint');
opt('trace-service', 'Q Server', 'Trace service name');
opt('trace-tags', '', 'Additional trace tags (comma separated name=value pairs)');
opt('statsd-server', '', 'StatsD server (host:port)');
opt('statsd-tags', '', 'Additional StatsD tags (comma separated name=value pairs)');
opt('network-name', 'cinet.tonlabs.io', 'Define the name of the network q-server is working with');
opt('cache-key-prefix', 'Q_', 'Prefix string to identify q-server keys in datacache'); // Stats Schema

const STATS = {
  start: 'start',
  prefix: 'qserver.',
  doc: {
    count: 'doc.count'
  },
  post: {
    count: 'post.count',
    failed: 'post.failed'
  },
  query: {
    count: 'query.count',
    time: 'query.time',
    active: 'query.active',
    failed: 'query.failed',
    slow: 'query.slow'
  },
  subscription: {
    active: 'subscription.active'
  },
  waitFor: {
    active: 'waitfor.active'
  }
};
exports.STATS = STATS;

function ensureProtocol(address, defaultProtocol) {
  return /^\w+:\/\//gi.test(address) ? address : `${defaultProtocol}://${address}`;
}

function parseArangoConfig(config, defMaxSockets) {
  const lowerCased = config.toLowerCase().trim();
  const hasProtocol = lowerCased.startsWith('http:') || lowerCased.startsWith('https:');
  const url = new URL(hasProtocol ? config : `https://${config}`);
  const protocol = url.protocol || 'https:';
  const host = url.port || protocol.toLowerCase() === 'https:' ? url.host : `${url.host}:8529`;
  const path = url.pathname !== '/' ? url.pathname : '';

  const param = name => url.searchParams.get(name) || '';

  return {
    server: `${protocol}//${host}${path}`,
    auth: url.username && `${url.username}:${url.password}`,
    name: param('name') || 'blockchain',
    maxSockets: Number.parseInt(param('maxSockets')) || defMaxSockets,
    listenerRestartTimeout: Number.parseInt(param('listenerRestartTimeout')) || DEFAULT_LISTENER_RESTART_TIMEOUT
  };
}

function parseMemCachedConfig(config) {
  return {
    server: config
  };
}

function overrideDefs(options, defs) {
  const resolved = {};
  Object.entries(options).forEach(([name, value]) => {
    const opt = value;
    resolved[name] = { ...opt,
      def: defs[name] || opt.def
    };
  });
  return resolved;
}

function resolveValues(values, env, def) {
  const resolved = {};
  Object.entries(def).forEach(([name, value]) => {
    const opt = value;
    resolved[name] = values[name] || env[opt.env] || def[name].def;
  });
  return resolved;
}

function createConfig(values, env, def) {
  const resolved = resolveValues(values, env, def);
  const {
    data,
    slowQueriesData,
    networkName,
    cacheKeyPrefix
  } = parseDataConfig(resolved);
  return {
    server: {
      host: resolved.host,
      port: Number.parseInt(resolved.port),
      keepAlive: Number.parseInt(resolved.keepAlive)
    },
    requests: {
      mode: resolved.requestsMode,
      server: resolved.requestsServer,
      topic: resolved.requestsTopic
    },
    data,
    slowQueriesData,
    authorization: {
      endpoint: resolved.authEndpoint
    },
    mamAccessKeys: new Set((resolved.mamAccessKeys || '').split(',')),
    jaeger: {
      endpoint: resolved.jaegerEndpoint,
      service: resolved.traceService,
      tags: parseTags(resolved.traceTags)
    },
    statsd: {
      server: resolved.statsdServer,
      tags: (resolved.statsdTags || '').split(',').map(x => x.trim()).filter(x => x)
    },
    networkName,
    cacheKeyPrefix
  };
} // Internals


function getIp() {
  const ipv4 = Object.values(_os.default.networkInterfaces()).reduce((acc, x) => acc.concat(x), []).find(x => x.family === 'IPv4' && !x.internal);
  return ipv4 && ipv4.address;
}

function parseTags(s) {
  const tags = {};
  s.split(',').forEach(t => {
    const i = t.indexOf('=');

    if (i >= 0) {
      tags[t.substr(0, i)] = t.substr(i + 1);
    } else {
      tags[t] = '';
    }
  });
  return tags;
}

function parseDataConfig(values) {
  function parse(prefix, defMaxSockets) {
    const opt = suffix => values[`${prefix}${suffix}`] || '';

    return {
      mut: parseArangoConfig(opt('Mut'), defMaxSockets),
      hot: parseArangoConfig(opt('Hot'), defMaxSockets),
      cold: opt('Cold').split(',').filter(x => x).map(x => parseArangoConfig(x, defMaxSockets)),
      cache: parseMemCachedConfig(opt('Cache'))
    };
  }

  const {
    networkName,
    cacheKeyPrefix
  } = values;
  return {
    data: parse('data', DEFAULT_ARANGO_MAX_SOCKETS),
    slowQueriesData: parse('slowQueries', DEFAULT_SLOW_QUERIES_ARANGO_MAX_SOCKETS),
    networkName,
    cacheKeyPrefix
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zZXJ2ZXIvY29uZmlnLmpzIl0sIm5hbWVzIjpbIkRFRkFVTFRfTElTVEVORVJfUkVTVEFSVF9USU1FT1VUIiwiREVGQVVMVF9BUkFOR09fTUFYX1NPQ0tFVFMiLCJERUZBVUxUX1NMT1dfUVVFUklFU19BUkFOR09fTUFYX1NPQ0tFVFMiLCJyZXF1ZXN0c01vZGUiLCJrYWZrYSIsInJlc3QiLCJwcm9ncmFtT3B0aW9ucyIsInRvUGFzY2FsIiwicyIsInRvVXBwZXJDYXNlIiwic3Vic3RyIiwidG9Mb3dlckNhc2UiLCJvcHQiLCJvcHRpb24iLCJkZWYiLCJkZXNjcmlwdGlvbiIsIndvcmRzIiwic3BsaXQiLCJuYW1lIiwic2xpY2UiLCJtYXAiLCJqb2luIiwiZW52IiwieCIsImRhdGFPcHQiLCJwcmVmaXgiLCJvIiwiZCIsInRleHQiLCJnZXRJcCIsIlNUQVRTIiwic3RhcnQiLCJkb2MiLCJjb3VudCIsInBvc3QiLCJmYWlsZWQiLCJxdWVyeSIsInRpbWUiLCJhY3RpdmUiLCJzbG93Iiwic3Vic2NyaXB0aW9uIiwid2FpdEZvciIsImVuc3VyZVByb3RvY29sIiwiYWRkcmVzcyIsImRlZmF1bHRQcm90b2NvbCIsInRlc3QiLCJwYXJzZUFyYW5nb0NvbmZpZyIsImNvbmZpZyIsImRlZk1heFNvY2tldHMiLCJsb3dlckNhc2VkIiwidHJpbSIsImhhc1Byb3RvY29sIiwic3RhcnRzV2l0aCIsInVybCIsIlVSTCIsInByb3RvY29sIiwiaG9zdCIsInBvcnQiLCJwYXRoIiwicGF0aG5hbWUiLCJwYXJhbSIsInNlYXJjaFBhcmFtcyIsImdldCIsInNlcnZlciIsImF1dGgiLCJ1c2VybmFtZSIsInBhc3N3b3JkIiwibWF4U29ja2V0cyIsIk51bWJlciIsInBhcnNlSW50IiwibGlzdGVuZXJSZXN0YXJ0VGltZW91dCIsInBhcnNlTWVtQ2FjaGVkQ29uZmlnIiwib3ZlcnJpZGVEZWZzIiwib3B0aW9ucyIsImRlZnMiLCJyZXNvbHZlZCIsIk9iamVjdCIsImVudHJpZXMiLCJmb3JFYWNoIiwidmFsdWUiLCJyZXNvbHZlVmFsdWVzIiwidmFsdWVzIiwiY3JlYXRlQ29uZmlnIiwiZGF0YSIsInNsb3dRdWVyaWVzRGF0YSIsIm5ldHdvcmtOYW1lIiwiY2FjaGVLZXlQcmVmaXgiLCJwYXJzZURhdGFDb25maWciLCJrZWVwQWxpdmUiLCJyZXF1ZXN0cyIsIm1vZGUiLCJyZXF1ZXN0c1NlcnZlciIsInRvcGljIiwicmVxdWVzdHNUb3BpYyIsImF1dGhvcml6YXRpb24iLCJlbmRwb2ludCIsImF1dGhFbmRwb2ludCIsIm1hbUFjY2Vzc0tleXMiLCJTZXQiLCJqYWVnZXIiLCJqYWVnZXJFbmRwb2ludCIsInNlcnZpY2UiLCJ0cmFjZVNlcnZpY2UiLCJ0YWdzIiwicGFyc2VUYWdzIiwidHJhY2VUYWdzIiwic3RhdHNkIiwic3RhdHNkU2VydmVyIiwic3RhdHNkVGFncyIsImZpbHRlciIsImlwdjQiLCJvcyIsIm5ldHdvcmtJbnRlcmZhY2VzIiwicmVkdWNlIiwiYWNjIiwiY29uY2F0IiwiZmluZCIsImZhbWlseSIsImludGVybmFsIiwidCIsImkiLCJpbmRleE9mIiwicGFyc2UiLCJzdWZmaXgiLCJtdXQiLCJob3QiLCJjb2xkIiwiY2FjaGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBbUJBOzs7O0FBbkJBOzs7Ozs7Ozs7Ozs7Ozs7O0FBaUZBLE1BQU1BLGdDQUFnQyxHQUFHLElBQXpDO0FBQ0EsTUFBTUMsMEJBQTBCLEdBQUcsR0FBbkM7QUFDQSxNQUFNQyx1Q0FBdUMsR0FBRyxDQUFoRDtBQUVPLE1BQU1DLFlBQVksR0FBRztBQUN4QkMsRUFBQUEsS0FBSyxFQUFFLE9BRGlCO0FBRXhCQyxFQUFBQSxJQUFJLEVBQUU7QUFGa0IsQ0FBckI7O0FBS0EsTUFBTUMsY0FBOEIsR0FBRyxFQUF2Qzs7O0FBRVAsTUFBTUMsUUFBUSxHQUFHQyxDQUFDLElBQUssR0FBRUEsQ0FBQyxDQUFDLENBQUQsQ0FBRCxDQUFLQyxXQUFMLEVBQW1CLEdBQUVELENBQUMsQ0FB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LG9CQUFvQixDQUFDM0QsR0FBRyxDQUFDLE9BQUQsQ0FBSjtBQUp4QixLQUFQO0FBTUg7O0FBRUQsUUFBTTtBQUFFeUUsSUFBQUEsV0FBRjtBQUFlQyxJQUFBQTtBQUFmLE1BQWtDTCxNQUF4QztBQUVBLFNBQU87QUFDSEUsSUFBQUEsSUFBSSxFQUFFdUMsS0FBSyxDQUFDLE1BQUQsRUFBU3pILDBCQUFULENBRFI7QUFFSG1GLElBQUFBLGVBQWUsRUFBRXNDLEtBQUssQ0FBQyxhQUFELEVBQWdCeEgsdUNBQWhCLENBRm5CO0FBR0htRixJQUFBQSxXQUhHO0FBSUhDLElBQUFBO0FBSkcsR0FBUDtBQU1IIiwic291cmNlc0NvbnRlbnQiOlsiLypcbi8qXG4gKiBDb3B5cmlnaHQgMjAxOC0yMDIwIFRPTiBERVYgU09MVVRJT05TIExURC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgU09GVFdBUkUgRVZBTFVBVElPTiBMaWNlbnNlICh0aGUgXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2VcbiAqIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZVxuICogTGljZW5zZSBhdDpcbiAqXG4gKiBodHRwOi8vd3d3LnRvbi5kZXYvbGljZW5zZXNcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIFRPTiBERVYgc29mdHdhcmUgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuLy8gQGZsb3dcblxuaW1wb3J0IG9zIGZyb20gJ29zJztcblxuLy8gQ29uZmlnIFNjaGVtYVxuXG5leHBvcnQgdHlwZSBRQXJhbmdvQ29uZmlnID0ge1xuICAgIHNlcnZlcjogc3RyaW5nLFxuICAgIG5hbWU6IHN0cmluZyxcbiAgICBhdXRoOiBzdHJpbmcsXG4gICAgbWF4U29ja2V0czogbnVtYmVyLFxuICAgIGxpc3RlbmVyUmVzdGFydFRpbWVvdXQ6IG51bWJlcjtcbn07XG5cbmV4cG9ydCB0eXBlIFFNZW1DYWNoZWRDb25maWcgPSB7XG4gICAgc2VydmVyOiBzdHJpbmcsXG59O1xuXG5leHBvcnQgdHlwZSBRRGF0YVByb3ZpZGVyc0NvbmZpZyA9IHtcbiAgICBtdXQ6IFFBcmFuZ29Db25maWc7XG4gICAgaG90OiBRQXJhbmdvQ29uZmlnO1xuICAgIGNvbGQ6IFFBcmFuZ29Db25maWdbXTtcbiAgICBjYWNoZTogUU1lbUNhY2hlZENvbmZpZztcbn07XG5cbmV4cG9ydCB0eXBlIFFDb25maWcgPSB7XG4gICAgc2VydmVyOiB7XG4gICAgICAgIGhvc3Q6IHN0cmluZyxcbiAgICAgICAgcG9ydDogbnVtYmVyLFxuICAgICAgICBrZWVwQWxpdmU6IG51bWJlcixcbiAgICB9LFxuICAgIHJlcXVlc3RzOiB7XG4gICAgICAgIG1vZGU6ICdrYWZrYScgfCAncmVzdCcsXG4gICAgICAgIHNlcnZlcjogc3RyaW5nLFxuICAgICAgICB0b3BpYzogc3RyaW5nLFxuICAgIH0sXG4gICAgZGF0YTogUURhdGFQcm92aWRlcnNDb25maWcsXG4gICAgc2xvd1F1ZXJpZXNEYXRhOiBRRGF0YVByb3ZpZGVyc0NvbmZpZyxcbiAgICBhdXRob3JpemF0aW9uOiB7XG4gICAgICAgIGVuZHBvaW50OiBzdHJpbmcsXG4gICAgfSxcbiAgICBqYWVnZXI6IHtcbiAgICAgICAgZW5kcG9pbnQ6IHN0cmluZyxcbiAgICAgICAgc2VydmljZTogc3RyaW5nLFxuICAgICAgICB0YWdzOiB7IFtzdHJpbmddOiBzdHJpbmcgfVxuICAgIH0sXG4gICAgc3RhdHNkOiB7XG4gICAgICAgIHNlcnZlcjogc3RyaW5nLFxuICAgICAgICB0YWdzOiBzdHJpbmdbXSxcbiAgICB9LFxuICAgIG1hbUFjY2Vzc0tleXM6IFNldDxzdHJpbmc+LFxuICAgIGlzVGVzdHM/OiBib29sZWFuLFxuICAgIG5ldHdvcmtOYW1lOiBzdHJpbmcsXG4gICAgY2FjaGVLZXlQcmVmaXg6IHN0cmluZyxcbn1cblxuZXhwb3J0IHR5cGUgUHJvZ3JhbU9wdGlvbiA9IHtcbiAgICBvcHRpb246IHN0cmluZyxcbiAgICBlbnY6IHN0cmluZyxcbiAgICBkZWY6IHN0cmluZyxcbiAgICBkZXNjcmlwdGlvbjogc3RyaW5nLFxufTtcbmV4cG9ydCB0eXBlIFByb2dyYW1PcHRpb25zID0geyBbc3RyaW5nXTogUHJvZ3JhbU9wdGlvbiB9O1xuXG5jb25zdCBERUZBVUxUX0xJU1RFTkVSX1JFU1RBUlRfVElNRU9VVCA9IDEwMDA7XG5jb25zdCBERUZBVUxUX0FSQU5HT19NQVhfU09DS0VUUyA9IDEwMDtcbmNvbnN0IERFRkFVTFRfU0xPV19RVUVSSUVTX0FSQU5HT19NQVhfU09DS0VUUyA9IDM7XG5cbmV4cG9ydCBjb25zdCByZXF1ZXN0c01vZGUgPSB7XG4gICAga2Fma2E6ICdrYWZrYScsXG4gICAgcmVzdDogJ3Jlc3QnLFxufTtcblxuZXhwb3J0IGNvbnN0IHByb2dyYW1PcHRpb25zOiBQcm9ncmFtT3B0aW9ucyA9IHt9O1xuXG5jb25zdCB0b1Bhc2NhbCA9IHMgPT4gYCR7c1swXS50b1VwcGVyQ2FzZSgpfSR7cy5zdWJzdHIoMSkudG9Mb3dlckNhc2UoKX1gO1xuXG5jb25zdCBvcHQgPSAob3B0aW9uOiBzdHJpbmcsIGRlZjogc3RyaW5nLCBkZXNjcmlwdGlvbjogc3RyaW5nKSA9PiB7XG4gICAgY29uc3Qgd29yZHMgPSBvcHRpb24uc3BsaXQoJy0nKTtcbiAgICBjb25zdCBuYW1lID0gYCR7d29yZHNbMF19JHt3b3Jkcy5zbGljZSgxKS5tYXAodG9QYXNjYWwpLmpvaW4oJycpfWA7XG4gICAgY29uc3QgZW52ID0gYFFfJHt3b3Jkcy5tYXAoeCA9PiB4LnRvVXBwZXJDYXNlKCkpLmpvaW4oJ18nKX1gO1xuICAgIHByb2dyYW1PcHRpb25zW25hbWVdID0ge1xuICAgICAgICBvcHRpb246IGAtLSR7b3B0aW9ufSA8dmFsdWU+YCxcbiAgICAgICAgZW52LFxuICAgICAgICBkZWYsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBgJHtkZXNjcmlwdGlvbn0ke2RlZiAmJiBgIChkZWZhdWx0OiBcIiR7ZGVmfVwiKWB9YCxcbiAgICB9XG59O1xuXG5jb25zdCBkYXRhT3B0ID0gKHByZWZpeDogc3RyaW5nKSA9PiB7XG4gICAgY29uc3QgbyA9IG5hbWUgPT4gYCR7cHJlZml4LnRvTG93ZXJDYXNlKCkuc3BsaXQoJyAnKS5qb2luKCctJyl9LSR7bmFtZX1gO1xuICAgIGNvbnN0IGQgPSB0ZXh0ID0+IGAke3RvUGFzY2FsKHByZWZpeCl9ICR7dGV4dH1gO1xuXG4gICAgb3B0KG8oJ211dCcpLCAnYXJhbmdvZGInLCBkKCdtdXRhYmxlIGRiIGNvbmZpZyB1cmwnKSk7XG4gICAgb3B0KG8oJ2hvdCcpLCAnYXJhbmdvZGInLCBkKCdob3QgZGIgY29uZmlnIHVybCcpKTtcbiAgICBvcHQobygnY29sZCcpLCAnJywgZCgnY29sZCBkYiBjb25maWcgdXJscyAoY29tbWEgc2VwYXJhdGVkKScpKTtcbiAgICBvcHQobygnY2FjaGUnKSwgJycsIGQoJ2NhY2hlIGNvbmZpZyB1cmwnKSk7XG59XG5cbm9wdCgnaG9zdCcsIGdldElwKCksICdMaXN0ZW5pbmcgYWRkcmVzcycpO1xub3B0KCdwb3J0JywgJzQwMDAnLCAnTGlzdGVuaW5nIHBvcnQnKTtcbm9wdCgna2VlcC1hbGl2ZScsICc2MDAwMCcsICdHcmFwaFFMIGtlZXAgYWxpdmUgbXMnKTtcblxub3B0KCdyZXF1ZXN0cy1tb2RlJywgJ2thZmthJywgJ1JlcXVlc3RzIG1vZGUgKGthZmthIHwgcmVzdCknKTtcbm9wdCgncmVxdWVzdHMtc2VydmVyJywgJ2thZmthOjkwOTInLCAnUmVxdWVzdHMgc2VydmVyIHVybCcpO1xub3B0KCdyZXF1ZXN0cy10b3BpYycsICdyZXF1ZXN0cycsICdSZXF1ZXN0cyB0b3BpYyBuYW1lJyk7XG5cbmRhdGFPcHQoJ2RhdGEnKTtcbmRhdGFPcHQoJ3Nsb3cgcXVlcmllcycpO1xuXG5vcHQoJ2F1dGgtZW5kcG9pbnQnLCAnJywgJ0F1dGggZW5kcG9pbnQnKTtcbm9wdCgnbWFtLWFjY2Vzcy1rZXlzJywgJycsICdBY2Nlc3Mga2V5cyB1c2VkIHRvIGF1dGhvcml6ZSBtYW0gZW5kcG9pbnQgYWNjZXNzJyk7XG5cbm9wdCgnamFlZ2VyLWVuZHBvaW50JywgJycsICdKYWVnZXIgZW5kcG9pbnQnKTtcbm9wdCgndHJhY2Utc2VydmljZScsICdRIFNlcnZlcicsICdUcmFjZSBzZXJ2aWNlIG5hbWUnKTtcbm9wdCgndHJhY2UtdGFncycsICcnLCAnQWRkaXRpb25hbCB0cmFjZSB0YWdzIChjb21tYSBzZXBhcmF0ZWQgbmFtZT12YWx1ZSBwYWlycyknKTtcblxub3B0KCdzdGF0c2Qtc2VydmVyJywgJycsICdTdGF0c0Qgc2VydmVyIChob3N0OnBvcnQpJyk7XG5vcHQoJ3N0YXRzZC10YWdzJywgJycsICdBZGRpdGlvbmFsIFN0YXRzRCB0YWdzIChjb21tYSBzZXBhcmF0ZWQgbmFtZT12YWx1ZSBwYWlycyknKTtcblxub3B0KCduZXR3b3JrLW5hbWUnLCAnY2luZXQudG9ubGFicy5pbycsICdEZWZpbmUgdGhlIG5hbWUgb2YgdGhlIG5ldHdvcmsgcS1zZXJ2ZXIgaXMgd29ya2luZyB3aXRoJyk7XG5cbm9wdCgnY2FjaGUta2V5LXByZWZpeCcsICdRXycsICdQcmVmaXggc3RyaW5nIHRvIGlkZW50aWZ5IHEtc2VydmVyIGtleXMgaW4gZGF0YWNhY2hlJyk7XG5cbi8vIFN0YXRzIFNjaGVtYVxuXG5leHBvcnQgY29uc3QgU1RBVFMgPSB7XG4gICAgc3RhcnQ6ICdzdGFydCcsXG4gICAgcHJlZml4OiAncXNlcnZlci4nLFxuICAgIGRvYzoge1xuICAgICAgICBjb3VudDogJ2RvYy5jb3VudCcsXG4gICAgfSxcbiAgICBwb3N0OiB7XG4gICAgICAgIGNvdW50OiAncG9zdC5jb3VudCcsXG4gICAgICAgIGZhaWxlZDogJ3Bvc3QuZmFpbGVkJyxcbiAgICB9LFxuICAgIHF1ZXJ5OiB7XG4gICAgICAgIGNvdW50OiAncXVlcnkuY291bnQnLFxuICAgICAgICB0aW1lOiAncXVlcnkudGltZScsXG4gICAgICAgIGFjdGl2ZTogJ3F1ZXJ5LmFjdGl2ZScsXG4gICAgICAgIGZhaWxlZDogJ3F1ZXJ5LmZhaWxlZCcsXG4gICAgICAgIHNsb3c6ICdxdWVyeS5zbG93JyxcbiAgICB9LFxuICAgIHN1YnNjcmlwdGlvbjoge1xuICAgICAgICBhY3RpdmU6ICdzdWJzY3JpcHRpb24uYWN0aXZlJyxcbiAgICB9LFxuICAgIHdhaXRGb3I6IHtcbiAgICAgICAgYWN0aXZlOiAnd2FpdGZvci5hY3RpdmUnLFxuICAgIH0sXG59O1xuXG5cbmV4cG9ydCBmdW5jdGlvbiBlbnN1cmVQcm90b2NvbChhZGRyZXNzOiBzdHJpbmcsIGRlZmF1bHRQcm90b2NvbDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICByZXR1cm4gL15cXHcrOlxcL1xcLy9naS50ZXN0KGFkZHJlc3MpID8gYWRkcmVzcyA6IGAke2RlZmF1bHRQcm90b2NvbH06Ly8ke2FkZHJlc3N9YDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlQXJhbmdvQ29uZmlnKGNvbmZpZzogc3RyaW5nLCBkZWZNYXhTb2NrZXRzOiBudW1iZXIpOiBRQXJhbmdvQ29uZmlnIHtcbiAgICBjb25zdCBsb3dlckNhc2VkID0gY29uZmlnLnRvTG93ZXJDYXNlKCkudHJpbSgpO1xuICAgIGNvbnN0IGhhc1Byb3RvY29sID0gbG93ZXJDYXNlZC5zdGFydHNXaXRoKCdodHRwOicpIHx8IGxvd2VyQ2FzZWQuc3RhcnRzV2l0aCgnaHR0cHM6Jyk7XG4gICAgY29uc3QgdXJsID0gbmV3IFVSTChoYXNQcm90b2NvbCA/IGNvbmZpZyA6IGBodHRwczovLyR7Y29uZmlnfWApO1xuICAgIGNvbnN0IHByb3RvY29sID0gdXJsLnByb3RvY29sIHx8ICdodHRwczonO1xuICAgIGNvbnN0IGhvc3QgPSAodXJsLnBvcnQgfHwgcHJvdG9jb2wudG9Mb3dlckNhc2UoKSA9PT0gJ2h0dHBzOicpID8gdXJsLmhvc3QgOiBgJHt1cmwuaG9zdH06ODUyOWA7XG4gICAgY29uc3QgcGF0aCA9IHVybC5wYXRobmFtZSAhPT0gJy8nID8gdXJsLnBhdGhuYW1lIDogJyc7XG4gICAgY29uc3QgcGFyYW0gPSBuYW1lID0+IHVybC5zZWFyY2hQYXJhbXMuZ2V0KG5hbWUpIHx8ICcnO1xuICAgIHJldHVybiB7XG4gICAgICAgIHNlcnZlcjogYCR7cHJvdG9jb2x9Ly8ke2hvc3R9JHtwYXRofWAsXG4gICAgICAgIGF1dGg6IHVybC51c2VybmFtZSAmJiBgJHt1cmwudXNlcm5hbWV9OiR7dXJsLnBhc3N3b3JkfWAsXG4gICAgICAgIG5hbWU6IHBhcmFtKCduYW1lJykgfHwgJ2Jsb2NrY2hhaW4nLFxuICAgICAgICBtYXhTb2NrZXRzOiBOdW1iZXIucGFyc2VJbnQocGFyYW0oJ21heFNvY2tldHMnKSkgfHwgZGVmTWF4U29ja2V0cyxcbiAgICAgICAgbGlzdGVuZXJSZXN0YXJ0VGltZW91dDogTnVtYmVyLnBhcnNlSW50KHBhcmFtKCdsaXN0ZW5lclJlc3RhcnRUaW1lb3V0JykpIHx8IERFRkFVTFRfTElTVEVORVJfUkVTVEFSVF9USU1FT1VULFxuICAgIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlTWVtQ2FjaGVkQ29uZmlnKGNvbmZpZzogc3RyaW5nKTogUU1lbUNhY2hlZENvbmZpZyB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgc2VydmVyOiBjb25maWcsXG4gICAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gb3ZlcnJpZGVEZWZzKG9wdGlvbnM6IFByb2dyYW1PcHRpb25zLCBkZWZzOiBhbnkpOiBQcm9ncmFtT3B0aW9ucyB7XG4gICAgY29uc3QgcmVzb2x2ZWQgPSB7fTtcbiAgICBPYmplY3QuZW50cmllcyhvcHRpb25zKS5mb3JFYWNoKChbbmFtZSwgdmFsdWVdKSA9PiB7XG4gICAgICAgIGNvbnN0IG9wdCA9ICgodmFsdWU6IGFueSk6IFByb2dyYW1PcHRpb24pO1xuICAgICAgICByZXNvbHZlZFtuYW1lXSA9IHtcbiAgICAgICAgICAgIC4uLm9wdCxcbiAgICAgICAgICAgIGRlZjogZGVmc1tuYW1lXSB8fCBvcHQuZGVmLFxuICAgICAgICB9O1xuICAgIH0pO1xuICAgIHJldHVybiByZXNvbHZlZDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlc29sdmVWYWx1ZXModmFsdWVzOiBhbnksIGVudjogYW55LCBkZWY6IFByb2dyYW1PcHRpb25zKTogYW55IHtcbiAgICBjb25zdCByZXNvbHZlZCA9IHt9O1xuICAgIE9iamVjdC5lbnRyaWVzKGRlZikuZm9yRWFjaCgoW25hbWUsIHZhbHVlXSkgPT4ge1xuICAgICAgICBjb25zdCBvcHQgPSAoKHZhbHVlOiBhbnkpOiBQcm9ncmFtT3B0aW9uKTtcbiAgICAgICAgcmVzb2x2ZWRbbmFtZV0gPSB2YWx1ZXNbbmFtZV0gfHwgZW52W29wdC5lbnZdIHx8IGRlZltuYW1lXS5kZWY7XG4gICAgfSk7XG4gICAgcmV0dXJuIHJlc29sdmVkO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlQ29uZmlnKFxuICAgIHZhbHVlczogYW55LFxuICAgIGVudjogYW55LFxuICAgIGRlZjogUHJvZ3JhbU9wdGlvbnMsXG4pOiBRQ29uZmlnIHtcbiAgICBjb25zdCByZXNvbHZlZCA9IHJlc29sdmVWYWx1ZXModmFsdWVzLCBlbnYsIGRlZik7XG4gICAgY29uc3QgeyBkYXRhLCBzbG93UXVlcmllc0RhdGEsIG5ldHdvcmtOYW1lLCBjYWNoZUtleVByZWZpeCB9ID0gcGFyc2VEYXRhQ29uZmlnKHJlc29sdmVkKTtcbiAgICByZXR1cm4ge1xuICAgICAgICBzZXJ2ZXI6IHtcbiAgICAgICAgICAgIGhvc3Q6IHJlc29sdmVkLmhvc3QsXG4gICAgICAgICAgICBwb3J0OiBOdW1iZXIucGFyc2VJbnQocmVzb2x2ZWQucG9ydCksXG4gICAgICAgICAgICBrZWVwQWxpdmU6IE51bWJlci5wYXJzZUludChyZXNvbHZlZC5rZWVwQWxpdmUpLFxuICAgICAgICB9LFxuICAgICAgICByZXF1ZXN0czoge1xuICAgICAgICAgICAgbW9kZTogcmVzb2x2ZWQucmVxdWVzdHNNb2RlLFxuICAgICAgICAgICAgc2VydmVyOiByZXNvbHZlZC5yZXF1ZXN0c1NlcnZlcixcbiAgICAgICAgICAgIHRvcGljOiByZXNvbHZlZC5yZXF1ZXN0c1RvcGljLFxuICAgICAgICB9LFxuICAgICAgICBkYXRhLFxuICAgICAgICBzbG93UXVlcmllc0RhdGEsXG4gICAgICAgIGF1dGhvcml6YXRpb246IHtcbiAgICAgICAgICAgIGVuZHBvaW50OiByZXNvbHZlZC5hdXRoRW5kcG9pbnQsXG4gICAgICAgIH0sXG4gICAgICAgIG1hbUFjY2Vzc0tleXM6IG5ldyBTZXQoKHJlc29sdmVkLm1hbUFjY2Vzc0tleXMgfHwgJycpLnNwbGl0KCcsJykpLFxuICAgICAgICBqYWVnZXI6IHtcbiAgICAgICAgICAgIGVuZHBvaW50OiByZXNvbHZlZC5qYWVnZXJFbmRwb2ludCxcbiAgICAgICAgICAgIHNlcnZpY2U6IHJlc29sdmVkLnRyYWNlU2VydmljZSxcbiAgICAgICAgICAgIHRhZ3M6IHBhcnNlVGFncyhyZXNvbHZlZC50cmFjZVRhZ3MpLFxuICAgICAgICB9LFxuICAgICAgICBzdGF0c2Q6IHtcbiAgICAgICAgICAgIHNlcnZlcjogcmVzb2x2ZWQuc3RhdHNkU2VydmVyLFxuICAgICAgICAgICAgdGFnczogKHJlc29sdmVkLnN0YXRzZFRhZ3MgfHwgJycpLnNwbGl0KCcsJykubWFwKHggPT4geC50cmltKCkpLmZpbHRlcih4ID0+IHgpLFxuICAgICAgICB9LFxuICAgICAgICBuZXR3b3JrTmFtZSxcbiAgICAgICAgY2FjaGVLZXlQcmVmaXgsXG4gICAgfTtcbn1cblxuLy8gSW50ZXJuYWxzXG5cbmZ1bmN0aW9uIGdldElwKCk6IHN0cmluZyB7XG4gICAgY29uc3QgaXB2NCA9IChPYmplY3QudmFsdWVzKG9zLm5ldHdvcmtJbnRlcmZhY2VzKCkpOiBhbnkpXG4gICAgICAgIC5yZWR1Y2UoKGFjYywgeCkgPT4gYWNjLmNvbmNhdCh4KSwgW10pXG4gICAgICAgIC5maW5kKHggPT4geC5mYW1pbHkgPT09ICdJUHY0JyAmJiAheC5pbnRlcm5hbCk7XG4gICAgcmV0dXJuIGlwdjQgJiYgaXB2NC5hZGRyZXNzO1xufVxuXG5cbmZ1bmN0aW9uIHBhcnNlVGFncyhzOiBzdHJpbmcpOiB7IFtzdHJpbmddOiBzdHJpbmcgfSB7XG4gICAgY29uc3QgdGFnczogeyBbc3RyaW5nXTogc3RyaW5nIH0gPSB7fTtcbiAgICBzLnNwbGl0KCcsJykuZm9yRWFjaCgodCkgPT4ge1xuICAgICAgICBjb25zdCBpID0gdC5pbmRleE9mKCc9Jyk7XG4gICAgICAgIGlmIChpID49IDApIHtcbiAgICAgICAgICAgIHRhZ3NbdC5zdWJzdHIoMCwgaSldID0gdC5zdWJzdHIoaSArIDEpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGFnc1t0XSA9ICcnO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHRhZ3M7XG5cbn1cblxuXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VEYXRhQ29uZmlnKHZhbHVlczogYW55KToge1xuICAgIGRhdGE6IFFEYXRhUHJvdmlkZXJzQ29uZmlnLFxuICAgIHNsb3dRdWVyaWVzRGF0YTogUURhdGFQcm92aWRlcnNDb25maWcsXG4gICAgbmV0d29ya05hbWU6IHN0cmluZyxcbiAgICBjYWNoZUtleVByZWZpeDogc3RyaW5nLFxufSB7XG4gICAgZnVuY3Rpb24gcGFyc2UocHJlZml4OiBzdHJpbmcsIGRlZk1heFNvY2tldHM6IG51bWJlcik6IFFEYXRhUHJvdmlkZXJzQ29uZmlnIHtcbiAgICAgICAgY29uc3Qgb3B0ID0gKHN1ZmZpeDogc3RyaW5nKTogc3RyaW5nID0+IHZhbHVlc1tgJHtwcmVmaXh9JHtzdWZmaXh9YF0gfHwgJyc7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBtdXQ6IHBhcnNlQXJhbmdvQ29uZmlnKG9wdCgnTXV0JyksIGRlZk1heFNvY2tldHMpLFxuICAgICAgICAgICAgaG90OiBwYXJzZUFyYW5nb0NvbmZpZyhvcHQoJ0hvdCcpLCBkZWZNYXhTb2NrZXRzKSxcbiAgICAgICAgICAgIGNvbGQ6IG9wdCgnQ29sZCcpLnNwbGl0KCcsJykuZmlsdGVyKHggPT4geCkubWFwKHggPT4gcGFyc2VBcmFuZ29Db25maWcoeCwgZGVmTWF4U29ja2V0cykpLFxuICAgICAgICAgICAgY2FjaGU6IHBhcnNlTWVtQ2FjaGVkQ29uZmlnKG9wdCgnQ2FjaGUnKSksXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCB7IG5ldHdvcmtOYW1lLCBjYWNoZUtleVByZWZpeCB9ID0gdmFsdWVzO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgZGF0YTogcGFyc2UoJ2RhdGEnLCBERUZBVUxUX0FSQU5HT19NQVhfU09DS0VUUyksXG4gICAgICAgIHNsb3dRdWVyaWVzRGF0YTogcGFyc2UoJ3Nsb3dRdWVyaWVzJywgREVGQVVMVF9TTE9XX1FVRVJJRVNfQVJBTkdPX01BWF9TT0NLRVRTKSxcbiAgICAgICAgbmV0d29ya05hbWUsXG4gICAgICAgIGNhY2hlS2V5UHJlZml4LFxuICAgIH07XG59XG4iXX0=